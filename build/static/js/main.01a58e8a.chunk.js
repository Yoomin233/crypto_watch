(this["webpackJsonpcrypto-watch"]=this["webpackJsonpcrypto-watch"]||[]).push([[0],{18:function(n,e,t){"use strict";var c,r,i=t(2),o=t(3),a=t(0),s=Object(o.b)(c||(c=Object(i.a)(["\n    to {\n        transform: rotate(1turn);\n    }\n"]))),l=o.a.span(r||(r=Object(i.a)(["\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-grow: 1;\n  > span {\n    border: 3px solid var(--border-color);\n    border-radius: 50%;\n    border-top-color: var(--text-color);\n    width: 1em;\n    height: 1em;\n    animation: "," 1s linear 0s infinite;\n  }\n"])),s);e.a=function(){return Object(a.jsx)(l,{children:Object(a.jsx)("span",{})})}},27:function(n,e,t){"use strict";var c=t(32),r=t(33),i=function(){function n(){Object(c.a)(this,n),this.cbs=void 0,this.cbs={}}return Object(r.a)(n,[{key:"subscribe",value:function(n,e){return this.cbs[n]||(this.cbs[n]=[]),this.cbs[n].push(e),e}},{key:"unsubscribe",value:function(n,e){this.cbs[n]&&(this.cbs[n]=this.cbs[n].filter((function(n){return n!==e})),0===this.cbs[n].length&&delete this.cbs[n])}},{key:"emit",value:function(n,e){this.cbs[n]&&this.cbs[n].forEach((function(n){return n(e)}))}}]),n}();e.a=new i},38:function(n,e,t){},58:function(n,e,t){"use strict";t.r(e);var c,r,i,o,a,s,l,d,u,b,p=t(1),f=t.n(p),j=t(28),h=t.n(j),m=(t(38),t(11)),g=t(6),x=t(4),O=t(2),v=t(3),w=t(0),k=v.a.p(c||(c=Object(O.a)(["\n  position: fixed;\n  bottom: 0;\n  margin: 0px auto;\n  font-size: 0.8em;\n  padding: 8px;\n  width: 100%;\n  background-color: var(--background-color);\n  /* border-top: 1px solid var(--border-color); */\n  display: grid;\n  grid-auto-flow: column;\n  grid-template-columns: 1fr 1fr;\n  align-items: center;\n  transition: all 0.3s ease-in-out, transform 0.3s linear 3s;\n\n  backdrop-filter: blur(6px);\n  a {\n    color: var(--text-color);\n    color: inherit;\n  }\n\n  &.Connecting {\n    background-color: yellow;\n    color: #000;\n  }\n  &.Connected {\n    background-color: rgba(0, 255, 0, 0.33);\n    transform: translateY(calc(100% - 4px));\n  }\n  &.Disconnected {\n    background-color: var(--down-color);\n  }\n  > *:first-child {\n    justify-self: start;\n  }\n  > *:last-child {\n    justify-self: end;\n  }\n"]))),y=function(n){var e=n.wsStatus,t=n.lastRefetch,c=n.reconnect,r=e,i=0===r||void 0===r?"Connecting":1===r?"Connected":3===r?"Disconnected":void 0;return Object(w.jsxs)(k,{className:i,children:[Object(w.jsx)("span",{children:Object(w.jsx)("i",{children:((+new Date-Number(t))/1e3).toFixed(0)+" Seconds ago"})}),Object(w.jsxs)("span",{children:[Object(w.jsx)("i",{children:i}),3===r&&Object(w.jsx)("button",{onClick:c,children:"Reconnect"})]})]})},S=t(18),C=v.a.div(r||(r=Object(O.a)(["\n  position: relative;\n  overflow: hidden;\n  display: inline-block;\n  padding: 6px 8px;\n  /* margin-top: 8px; */\n  vertical-align: top;\n  /* display: inline-block; */\n  /* border-left: 1px solid #fff; */\n  /* border-radius: 4px; */\n  cursor: pointer;\n  box-sizing: border-box;\n  user-select: none;\n  white-space: nowrap;\n  width: 33%;\n  border-bottom: 1px solid var(--border-color);\n  @media screen and (min-width: 1200px) {\n    width: 25%;\n  }\n  @media screen and (min-width: 451px) and (max-width: 750px) {\n    width: calc(50%);\n  }\n  @media screen and (max-width: 450px) {\n    width: 100%;\n    /* overflow: hidden; */\n  }\n  button {\n    font-size: 0.8em;\n    height: 80%;\n  }\n  .buttons {\n    display: grid;\n    grid-auto-flow: column;\n    gap: 4px;\n    margin-left: 8px;\n    position: absolute;\n    right: 0;\n    top: 0;\n    height: 100%;\n    z-index: 10;\n    background-color: var(--background-color);\n    /* transform: translateX(calc(101%)); */\n    transition: all 0.3s ease;\n    /* &.edit {\n      transform: none;\n    } */\n    /* overflow: hidden; */\n    /* > button {\n    } */\n    /* background: red; */\n  }\n"]))),N=v.a.div(i||(i=Object(O.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  /* &:hover {\n    transform: translateY(-2px);\n  } */\n  @media screen and (max-width: 450px) {\n    > a:first-child {\n      max-width: 45vw;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n  > a {\n    color: inherit;\n    font-size: 1.1em;\n    text-decoration: none;\n    font-weight: bold;\n  }\n  img {\n    width: 2rem;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n  span.price {\n    font-weight: bold;\n    font-size: 1.2em;\n    transition: all 0.1s linear;\n    &.up {\n      color: var(--up-color);\n    }\n    &.down {\n      color: var(--down-color);\n    }\n  }\n  span.percentage {\n    padding: 4px 8px;\n    border-radius: 4px;\n    color: #fff;\n    margin-left: 12px;\n    display: inline-block;\n    text-align: center;\n    /* width: 4.5em; */\n  }\n"]))),D=v.a.div(o||(o=Object(O.a)(["\n  padding-top: 8px;\n  /* border-bottom: 1px solid var(--border-color); */\n  justify-content: space-between;\n  display: flex;\n  position: relative;\n  overflow: hidden;\n"]))),M=v.a.div(a||(a=Object(O.a)(["\n  display: flex;\n  flex-grow: 1;\n  .switch {\n    display: grid;\n    margin-right: 8px;\n    > span {\n      border: 1px solid transparent;\n      border-top-left-radius: 6px;\n      border-bottom-left-radius: 6px;\n      padding: 2px 4px;\n      border-right-color: #1fe230;\n      &.selected {\n        /* color: yellow; */\n        border-color: #1fe230;\n        border-right-color: transparent;\n      }\n    }\n  }\n  img {\n    width: 100%;\n  }\n"]))),L=Object(p.lazy)((function(){return Promise.all([t.e(4),t.e(3)]).then(t.bind(null,61))})),E=Object(p.memo)((function(n){var e=n.id,t=void 0===e?1:e,c=Object(p.useState)("1D"),r=Object(x.a)(c,2),i=r[0],o=r[1];return Object(w.jsxs)(M,{children:[Object(w.jsxs)("div",{className:"switch",children:[Object(w.jsx)("span",{className:"1D"===i?"selected":void 0,onClick:function(){return o("1D")},children:"24h"}),Object(w.jsx)("span",{className:"7D"===i?"selected":void 0,onClick:function(){return o("7D")},children:"7D"}),Object(w.jsx)("span",{className:"1M"===i?"selected":void 0,onClick:function(){return o("1M")},children:"1M"}),Object(w.jsx)("span",{className:"3M"===i?"selected":void 0,onClick:function(){return o("3M")},children:"3M"}),Object(w.jsx)("span",{className:"1Y"===i?"selected":void 0,onClick:function(){return o("1Y")},children:"1Y"})]}),Object(w.jsx)(R,{id:t,period:i})]})})),R=function(n){var e=n.id,t=void 0===e?1:e,c=n.period,r=void 0===c?"1D":c;return Object(w.jsx)(p.Suspense,{fallback:Object(w.jsx)(S.a,{}),children:Object(w.jsx)(L,{id:t,period:r})})},I=Object(p.memo)((function(n){var e=n.name,t=n.info,c=n.onRemove,r=n.prices,i=n.setPrices,o=n.idx,a=n.expandStatus,s=n.setExpandStatus,l=n.edit,d=t.id,u=t.p24h,b=t.price,f=t.slug,j=t.symbol,h=Object(p.useRef)(b),O=Object(p.useState)(0),v=Object(x.a)(O,2),k=v[0],y=v[1];Object(p.useEffect)((function(){b!==h.current&&void 0!==b&&void 0!==h.current&&(h.current<b?y(1):y(-1),setTimeout((function(){return y(0)}),1e3)),h.current=b}),[b]);var S=function(n){var e=n?-1:1,t=r[o+e];r[o+e]=r[o],r[o]=t,i(Object(m.a)(r))},M=!!a[d],L=Object(p.useMemo)((function(){return b?b.toFixed(function(n){if(n>=1)return Math.max(1,4-Math.floor(Math.log10(n)));for(var e=-2;1-n>=0;)n*=10,e+=1;return Math.max(4,4+e)}(b)):"-"}),[b]);return Object(w.jsxs)(C,{children:[Object(w.jsxs)(N,{onClick:function(){a[d]=!a[d],s(Object(g.a)({},a))},children:[Object(w.jsxs)("a",{href:"https://coinmarketcap.com/currencies/".concat(f,"/"),target:"_blank",rel:"noreferrer",onClick:function(n){return n.stopPropagation()},children:[Object(w.jsx)("img",{src:"https://s2.coinmarketcap.com/static/img/coins/64x64/".concat(d,".png"),alt:d}),e||j||"unknown"]}),l?Object(w.jsxs)("div",{className:"buttons",children:[Object(w.jsx)("button",{onClick:function(){return S(!0)},disabled:0===o,children:"\u21e7"}),Object(w.jsx)("button",{onClick:function(){return S()},disabled:o===r.length-1,children:"\u21e9"}),Object(w.jsx)("button",{onClick:function(){return c(d)},className:"danger",children:"\u274c"})]}):Object(w.jsxs)("span",{children:[Object(w.jsx)("span",{className:"price ".concat(1===k?"up":-1===k?"down":void 0),children:L}),Object(w.jsx)("span",{className:"percentage",style:{backgroundColor:u>0?"rgba(0, 255, 0, ".concat(Math.max(.5,Math.sqrt(Math.abs(u/10))),")"):"rgba(255, 0, 0, ".concat(Math.max(.5,Math.sqrt(Math.abs(u/10))),")")},children:u?"".concat(u.toFixed(2),"%"):""})]})]},d),M&&Object(w.jsx)(D,{children:Object(w.jsx)(E,{id:d})})]})})),_=v.a.div(s||(s=Object(O.a)(["\n  cursor: pointer;\n  margin: 4px auto;\n  > img {\n    width: 1.5em;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n"]))),z=v.a.div(l||(l=Object(O.a)(["\n  margin: 12px 0px;\n  > div {\n    position: absolute;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    width: 100%;\n    text-align: left;\n    padding-left: 8px;\n    z-index: 10;\n  }\n"]))),P=function(n){var e=n.onAdd,t=n.mapData,c=Object(p.useState)(""),r=Object(x.a)(c,2),i=r[0],o=r[1],a=Object.values(t),s=Object(p.useRef)(null),l=i?a.filter((function(n){return n.name.toLowerCase().includes(i.toLowerCase())||n.symbol.toLowerCase().includes(i.toLowerCase())})):[];return Object(w.jsxs)(z,{children:[Object(w.jsx)("input",{value:i,onChange:function(n){return o(n.target.value)},placeholder:a.length?"Try 'Bitcoin'":"Loading...",disabled:!a.length,ref:s}),l.length?Object(w.jsx)("div",{children:l.slice(0,10).map((function(n){return Object(w.jsxs)(_,{onClick:function(){e(n.id),o(""),setTimeout((function(){var n;null===(n=s.current)||void 0===n||n.focus()}),500)},children:[Object(w.jsx)("img",{src:"https://s2.coinmarketcap.com/static/img/coins/64x64/".concat(n.id,".png"),alt:n.id}),n.name]},n.id)}))}):null]})},Y=t(10),A=t.n(Y),F=function(n,e){var t=Object(p.useState)(new Date),c=Object(x.a)(t,2),r=c[0],i=c[1],o=function(){return A.a.get("https://api.coinmarketcap.com/data-api/v3/cryptocurrency/listing?ids=".concat(n.join(","),"&aux=ath")).then((function(n){var t=n.data;if(null===t||void 0===t?void 0:t.data){var c=t.data.cryptoCurrencyList;i(new Date),e((function(n){return n.map((function(n){var e,t,r,i,o=c.find((function(e){return e.id===n.id}));return o?Object(g.a)(Object(g.a)({},n),{},{price:(null===(e=o.quotes)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.price)||0,p24h:(null===(r=o.quotes)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.percentChange24h)||0,name:o.name,slug:o.slug}):n}))}))}}))};return Object(p.useEffect)((function(){o()}),[n.length,e]),[o,r]},J=function(n){var e=Object(p.useState)((function(){return localStorage.getItem(n)?JSON.parse(String(localStorage.getItem(n))).data:{}})),t=Object(x.a)(e,2),c=t[0],r=t[1],i=Object(p.useCallback)((function(){return A.a.get("https://api.coinmarketcap.com/data-api/v3/map/all?cryptoAux=status&limit=10000&listing_status=active&start=1").then((function(e){var t=e.data.data.cryptoCurrencyMap.reduce((function(n,e){return n[e.id]=e,n}),{});r(t),localStorage.setItem(n,JSON.stringify({data:t,timeStamp:+new Date}))}))}),[n]);return Object(p.useEffect)((function(){localStorage.getItem(n)?JSON.parse(String(localStorage.getItem(n))).timeStamp+864e5<=Number(new Date)&&(console.log("refetch!"),i()):(console.log("init fetch!"),i())}),[i,n]),c},T=function(n,e){var t=Object(p.useRef)(!1);Object(p.useEffect)((function(){t.current?(console.log("exec!"),n()):t.current=!0}),[e])},q=t(27),B=v.a.div(d||(d=Object(O.a)(["\n  display: flex;\n  justify-content: space-between;\n  padding: 8px;\n  /* position: absolute; */\n  /* bottom: 0.5em; */\n  width: 100%;\n  font-size: 0.8em;\n  a {\n    &:visited {\n      color: var(--text-color);\n    }\n  }\n"]))),K=function(){return Object(w.jsxs)(B,{className:"info",children:[Object(w.jsxs)("span",{children:["Data Source:"," ",Object(w.jsx)("a",{href:"https://coinmarketcap.com/",target:"_blank",rel:"noreferrer",children:"CoinMarketCap"})]}),"\xa0",Object(w.jsx)("span",{children:Object(w.jsx)("a",{href:"https://github.com/YueminHu/crypto_watch",target:"_blank",rel:"noreferrer",children:"Github"})})]})},U="LOCAL_ID_KEY",W=v.a.div(u||(u=Object(O.a)(["\n  text-align: left;\n  padding: 0px 8px;\n  /* padding-top: 8px; */\n"]))),G=v.a.div(b||(b=Object(O.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: sticky;\n  /* top: 0; */\n  background-image: linear-gradient(\n    to bottom,\n    var(--background-color) 0%,\n    var(--background-color) 70%,\n    transparent 100%\n  );\n  top: -1px;\n  > div:first-child {\n    flex-grow: 1;\n  }\n"]))),H=function(){return(localStorage.getItem(U)||new URL(window.location.href).searchParams.get("ids")||"").split("_").map((function(n){return{id:Number(n)||1}}))};function X(){var n=Object(p.useState)(0),e=Object(x.a)(n,2),t=e[0],c=e[1],r=Object(p.useState)(!1),i=Object(x.a)(r,2),o=i[0],a=i[1],s=Object(p.useState)(H),l=Object(x.a)(s,2),d=l[0],u=l[1],b=Object(p.useState)({}),f=Object(x.a)(b,2),j=f[0],h=f[1],O=d.map((function(n){return n.id})),v=Object(p.useRef)(!1),k=J("LOCAL_KEY"),S=Object(p.useRef)(),C=F(O,u),N=Object(x.a)(C,2),D=N[0],M=N[1],L=function n(){var e;try{e=new WebSocket("wss://stream.coinmarketcap.com/price/latest"),S.current=e}catch(t){console.log("reconnect!"),setTimeout((function(){n(),E(O)}),1e3)}},E=function n(e){if(S.current){var t=S.current;c(t.readyState),t.onopen=function(){console.log("ws connected!"),c(t.readyState),v.current&&(v.current=!1);var r={method:"subscribe",id:"price",data:{cryptoIds:e}};t.send(JSON.stringify(r)),t.onmessage=function(n){var e,t=JSON.parse(n.data);if(null===t||void 0===t||null===(e=t.d)||void 0===e?void 0:e.cr){var c=t.d.cr;q.a.emit("WS-".concat(c.id),c),u((function(n){return n.map((function(n){return n.id===c.id?Object(g.a)(Object(g.a)(Object(g.a)({},c),n),{},{price:c.p,p24h:c.p24h}):n}))}))}else console.log(t)},t.addEventListener("close",(function(r){console.log("ws closed!"),c(t.readyState),v.current||(console.log("reconnecting..."),D(),setTimeout((function(){L(),n(e)}),1e3))}))}}},R=function(){console.log("reconnect!"),function(){var n;null===(n=S.current)||void 0===n||n.close()}(),L(),E(O)},_=function(n,e){O.includes(n)&&e||u((function(t){return e?[].concat(Object(m.a)(t),[{id:n}]):t.filter((function(e){return e.id!==n}))}))};return T((function(){var n=O.join("_");!function(n){var e=new URL(window.location.href);e.searchParams.set("ids",n),window.history.replaceState("",document.title,e)}(n),localStorage.setItem(U,n)}),O.join()),Object(p.useEffect)((function(){O.length&&(v.current=!0,R())}),[O.length]),Object(w.jsxs)("div",{className:"App",children:[Object(w.jsxs)(G,{children:[Object(w.jsx)(P,{onAdd:function(n){return _(n,!0)},mapData:k}),Object(w.jsx)("button",{onClick:function(){!1||h({})},children:"Collapse All"}),"\xa0",Object(w.jsx)("button",{onClick:function(){return a(!o)},children:o?"Done":"Edit"})]}),Object(w.jsx)(W,{children:d.map((function(n,e){var t;return Object(w.jsx)(I,{name:null===(t=k[n.id])||void 0===t?void 0:t.symbol,info:n,onRemove:function(n){return _(n)},prices:d,setPrices:u,idx:e,expandStatus:j,setExpandStatus:h,edit:o},n.id)}))}),Object(w.jsx)(K,{}),O.length?Object(w.jsx)(y,{wsStatus:t,reconnect:R,lastRefetch:M}):null]})}var Q=function(n){n&&n instanceof Function&&t.e(5).then(t.bind(null,60)).then((function(e){var t=e.getCLS,c=e.getFID,r=e.getFCP,i=e.getLCP,o=e.getTTFB;t(n),c(n),r(n),i(n),o(n)}))};h.a.render(Object(w.jsx)(f.a.StrictMode,{children:Object(w.jsx)(X,{})}),document.getElementById("root")),Q()}},[[58,1,2]]]);
//# sourceMappingURL=main.01a58e8a.chunk.js.map