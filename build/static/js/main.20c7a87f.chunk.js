(this["webpackJsonpcrypto-watch"]=this["webpackJsonpcrypto-watch"]||[]).push([[0],{34:function(n,e,t){},54:function(n,e,t){"use strict";t.r(e);var c,r,o,i,a,s,l=t(0),d=t.n(l),u=t(26),p=t.n(u),f=(t(34),t(13)),b=t(6),m=t(5),g=t(3),j=t(4),h=t(1),v=j.a.p(c||(c=Object(g.a)(["\n  position: fixed;\n  bottom: 0;\n  margin: 0px auto;\n  font-size: 0.8em;\n  padding: 8px 0px;\n  width: 100%;\n  background-color: var(--background-color);\n  border-top: 1px solid var(--border-color);\n  > a {\n    color: var(--text-color);\n  }\n"]))),x=function(){return Object(h.jsxs)(v,{children:["Data Provider:"," ",Object(h.jsx)("a",{href:"https://coinmarketcap.com/",target:"_blank",rel:"noreferrer",children:"CoinMarketCap"})]})},O=j.a.div(r||(r=Object(g.a)(["\n  display: inline-flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px;\n  /* margin-top: 8px; */\n  width: calc(50% - 17px);\n  /* display: inline-block; */\n  /* border-left: 1px solid #fff; */\n  /* border-radius: 4px; */\n  cursor: pointer;\n  box-sizing: border-box;\n  user-select: none;\n  border-bottom: 1px solid var(--border-color);\n  /* &:hover {\n    transform: translateY(-2px);\n  } */\n  @media screen and (max-width: 450px) {\n    white-space: nowrap;\n    width: 100%;\n    border-left: none;\n    /* overflow: hidden; */\n    > a:first-child {\n      max-width: 45vw;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n  > a {\n    color: inherit;\n  }\n  img {\n    width: 2em;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n  span.price {\n    font-weight: bold;\n    font-size: 1.1em;\n    &.up {\n      color: var(--up-color);\n    }\n    &.down {\n      color: var(--down-color);\n    }\n  }\n  span.percentage {\n    padding: 8px 4px;\n    border-radius: 4px;\n    color: #fff;\n    margin-left: 12px;\n    display: inline-block;\n    text-align: center;\n    width: 4.5em;\n  }\n"]))),w=j.a.div(o||(o=Object(g.a)(["\n  padding: 8px;\n  border-bottom: 1px solid var(--border-color);\n  justify-content: space-between;\n  display: flex;\n"]))),y=function(n){var e=n.info,t=n.onRemove,c=n.prices,r=n.setPrices,o=n.idx,i=e.id,a=e.p24h,s=e.price,d=e.name,u=e.slug,p=Object(l.useRef)(s),b=Object(l.useRef)(!0),g=Object(l.useState)(!1),j=Object(m.a)(g,2),v=j[0],x=j[1];Object(l.useEffect)((function(){s!==p.current&&(b.current=p.current<s||void 0===s,p.current=s)}),[s]);var y=function(n){var e=n?-1:1,t=c[o+e];c[o+e]=c[o],c[o]=t,r(Object(f.a)(c))};return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(O,{children:[Object(h.jsxs)("a",{href:"https://coinmarketcap.com/currencies/".concat(u,"/"),target:"_blank",rel:"noreferrer",children:[Object(h.jsx)("img",{src:"https://s2.coinmarketcap.com/static/img/coins/64x64/".concat(i,".png"),alt:i}),d||"unknown"]}),Object(h.jsxs)("span",{onClick:function(){x(!v)},children:[Object(h.jsxs)("span",{className:"price ".concat(b.current?"up":"down"),children:[s?null===s||void 0===s?void 0:s.toFixed(4):"-",b.current?"\u2191":"\u2193"]}),Object(h.jsx)("span",{className:"percentage",style:{backgroundColor:a>0?"rgba(0, 255, 0, ".concat(Math.sqrt(Math.abs(a/10)),")"):"rgba(255, 0, 0, ".concat(Math.sqrt(Math.abs(a/10)),")")},children:a?"".concat(a.toFixed(2),"%"):""})]})]},i),v&&Object(h.jsxs)(w,{children:[Object(h.jsx)("button",{onClick:function(){return y(!0)},disabled:0===o,children:"Move Up\u2191"}),Object(h.jsx)("button",{onClick:function(){return y()},disabled:o===c.length-1,children:"Move Down\u2193"}),Object(h.jsx)("button",{onClick:function(){return t(i)},className:"danger",children:"Delete"})]})]})},k=j.a.div(i||(i=Object(g.a)(["\n  position: fixed;\n  bottom: 3em;\n  right: 12px;\n  max-width: 0.8em;\n  white-space: nowrap;\n  overflow: hidden;\n  max-width: 1em;\n  transition: all 0.3s ease-in-out;\n  cursor: pointer;\n  &:focus-within {\n    max-width: 20em;\n  }\n  > span:first-child {\n    width: 0.8em;\n    height: 0.8em;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n  > span.connecting {\n    background-color: yellow;\n  }\n  > span.connected {\n    background-color: var(--up-color);\n  }\n  > span.disconnected {\n    background-color: var(--down-color);\n  }\n"]))),S=function(n){var e,t=n.wsInstance,c=n.reconnect,r=null===(e=t.current)||void 0===e?void 0:e.readyState,o=0===r||void 0===r?"connecting":1===r?"connected":3===r?"disconnected":void 0;return Object(h.jsxs)(k,{tabIndex:-1,children:[Object(h.jsx)("span",{className:o}),"WS Status: ".concat(o),Object(h.jsx)("button",{onClick:c,style:{display:3===r?void 0:"none"},children:"Reconnect"})]})},C=t(12),L=t.n(C),I=function(n){var e=Object(l.useState)((function(){return localStorage.getItem(n)?JSON.parse(String(localStorage.getItem(n))).data:{}})),t=Object(m.a)(e,2),c=t[0],r=t[1],o=Object(l.useCallback)((function(){return L.a.get("https://api.coinmarketcap.com/data-api/v3/map/all?cryptoAux=status&limit=10000&listing_status=active&start=1").then((function(e){var t=e.data.data.cryptoCurrencyMap.reduce((function(n,e){return n[e.id]=e,n}),{});r(t),localStorage.setItem(n,JSON.stringify({data:t,timeStamp:+new Date}))}))}),[n]);return Object(l.useEffect)((function(){localStorage.getItem(n)?JSON.parse(String(localStorage.getItem(n))).timeStamp+864e5<=+new Date&&(console.log("refetch!"),o()):(console.log("init fetch!"),o())}),[o,n]),c},N=j.a.div(a||(a=Object(g.a)(["\n  cursor: pointer;\n  margin: 4px auto;\n  > img {\n    width: 1.5em;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n"]))),R=function(n){var e=n.onAdd,t=Object(l.useState)(""),c=Object(m.a)(t,2),r=c[0],o=c[1],i=I("LOCAL_KEY"),a=Object.values(i),s=Object(l.useRef)(null);Object(l.useEffect)((function(){var n;null===(n=s.current)||void 0===n||n.focus()}),[]);var d=r?a.filter((function(n){return n.name.toLowerCase().includes(r.toLowerCase())||n.symbol.toLowerCase().includes(r.toLowerCase())})):[];return Object(h.jsxs)("div",{style:{marginTop:24},children:[Object(h.jsx)("input",{value:r,onChange:function(n){return o(n.target.value)},placeholder:a.length?"Type Something...":"Loading...",disabled:!a.length,ref:s}),Object(h.jsx)("div",{children:d.slice(0,10).map((function(n){return Object(h.jsxs)(N,{onClick:function(){e(n.id),o(""),setTimeout((function(){var n;null===(n=s.current)||void 0===n||n.focus()}),500)},children:[Object(h.jsx)("img",{src:"https://s2.coinmarketcap.com/static/img/coins/64x64/".concat(n.id,".png"),alt:n.id}),n.name]},n.id)}))})]})},M=function(n,e){Object(l.useEffect)((function(){L.a.get("https://api.coinmarketcap.com/data-api/v3/cryptocurrency/listing?ids=".concat(n.join(","),"&aux=ath")).then((function(n){var t=n.data.data.cryptoCurrencyList;e((function(n){return n.map((function(n){var e,c,r,o,i=t.find((function(e){return e.id===n.id}));return i?Object(b.a)(Object(b.a)({},n),{},{price:(null===(e=i.quotes)||void 0===e||null===(c=e[0])||void 0===c?void 0:c.price)||0,p24h:(null===(r=i.quotes)||void 0===r||null===(o=r[0])||void 0===o?void 0:o.percentChange24h)||0,name:i.name,slug:i.slug}):n}))}))}))}),[n.length,e])},E=j.a.div(s||(s=Object(g.a)(["\n  text-align: left;\n  padding: 0px 8px;\n"])));function F(){var n=Object(l.useState)(0),e=Object(m.a)(n,2),t=(e[0],e[1]),c=Object(l.useState)((function(){var n=new URL(window.location.href).searchParams.get("ids");return n?n.split("_").map((function(n){return{id:Number(n)}})):[]})),r=Object(m.a)(c,2),o=r[0],i=r[1],a=o.map((function(n){return n.id})),s=Object(l.useRef)(!1);M(a,i);var d=Object(l.useRef)(),u=function n(){var e;try{e=new WebSocket("wss://stream.coinmarketcap.com/price/latest"),d.current=e}catch(t){console.log(t),setTimeout((function(){n(),p(a)}),5e3)}},p=function n(e){if(d.current){var c=d.current;t(c.readyState),c.onopen=function(){console.log("ws connected!"),t(c.readyState),s.current&&(s.current=!1);var r={method:"subscribe",id:"price",data:{cryptoIds:e}};c.send(JSON.stringify(r)),c.onmessage=function(n){var e,t=JSON.parse(n.data);if(null===t||void 0===t||null===(e=t.d)||void 0===e?void 0:e.cr){var c=t.d.cr;i((function(n){return n.map((function(n){return n.id===c.id?Object(b.a)(Object(b.a)({},n),{},{price:c.p,p24h:c.p24h}):n}))}))}else console.log(t)},c.addEventListener("close",(function(r){console.log("ws closed!"),t(c.readyState),s.current||(console.log("reconnecting..."),setTimeout((function(){console.log(e),u(),n(e)}),5e3))}))}}},g=function(){console.log("reconnect!"),function(){var n;null===(n=d.current)||void 0===n||n.close()}(),u(),p(a)},j=function(n,e){a.includes(n)&&e||i((function(t){return e?[].concat(Object(f.a)(t),[{id:n}]):t.filter((function(e){return e.id!==n}))}))};return Object(l.useEffect)((function(){if(a.length){s.current=!0,g();var n=new URL(window.location.href);n.searchParams.set("ids",a.join("_")),window.history.replaceState("",document.title,n)}}),[a.join()]),Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)(E,{children:o.map((function(n,e){return Object(h.jsx)(y,{info:n,onRemove:function(n){return j(n)},prices:o,setPrices:i,idx:e},n.id)}))}),Object(h.jsx)(S,{wsInstance:d,reconnect:g}),Object(h.jsx)(x,{}),Object(h.jsx)(R,{onAdd:function(n){return j(n,!0)}})]})}var J=function(n){n&&n instanceof Function&&t.e(3).then(t.bind(null,55)).then((function(e){var t=e.getCLS,c=e.getFID,r=e.getFCP,o=e.getLCP,i=e.getTTFB;t(n),c(n),r(n),o(n),i(n)}))};p.a.render(Object(h.jsx)(d.a.StrictMode,{children:Object(h.jsx)(F,{})}),document.getElementById("root")),J()}},[[54,1,2]]]);
//# sourceMappingURL=main.20c7a87f.chunk.js.map