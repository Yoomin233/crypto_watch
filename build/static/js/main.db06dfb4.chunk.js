(this["webpackJsonpcrypto-watch"]=this["webpackJsonpcrypto-watch"]||[]).push([[0],{34:function(n,e,t){},54:function(n,e,t){"use strict";t.r(e);var r,c,o,a,i,s,l,d,u,p,b,f=t(0),j=t.n(f),g=t(26),m=t.n(g),h=(t(34),t(6)),x=t(7),O=t(2),v=t(3),w=t(4),k=t(1),y=w.a.p(r||(r=Object(v.a)(["\n  position: fixed;\n  bottom: 0;\n  margin: 0px auto;\n  font-size: 0.8em;\n  padding: 8px;\n  width: 100%;\n  background-color: var(--background-color);\n  /* border-top: 1px solid var(--border-color); */\n  display: grid;\n  grid-auto-flow: column;\n  grid-template-columns: 1fr 1fr 1fr;\n  align-items: center;\n  transition: all 0.3s ease-in-out, transform 0.3s linear 3s;\n\n  backdrop-filter: blur(6px);\n  a {\n    color: var(--text-color);\n    color: inherit;\n  }\n\n  &.Connecting {\n    background-color: yellow;\n    color: #000;\n  }\n  &.Connected {\n    background-color: rgba(0, 255, 0, 0.33);\n    transform: translateY(calc(100% - 4px));\n  }\n  &.Disconnected {\n    background-color: var(--down-color);\n  }\n  > *:first-child {\n    justify-self: start;\n  }\n  > *:last-child {\n    justify-self: end;\n  }\n"]))),S=function(n){var e=n.wsStatus,t=n.lastRefetch,r=0===e||void 0===e?"Connecting":1===e?"Connected":3===e?"Disconnected":void 0;return Object(k.jsxs)(y,{className:r,children:[Object(k.jsxs)("span",{children:["Data Source:"," ",Object(k.jsx)("a",{href:"https://coinmarketcap.com/",target:"_blank",rel:"noreferrer",children:"CoinMarketCap"})]}),Object(k.jsx)("span",{children:Object(k.jsx)("i",{children:((+new Date-Number(t))/1e3).toFixed(0)+" Seconds ago"})}),Object(k.jsx)("span",{children:Object(k.jsx)("i",{children:r})})]})},C=Object(w.b)(c||(c=Object(v.a)(["\n    to {\n        transform: rotate(1turn);\n    }\n"]))),N=w.a.span(o||(o=Object(v.a)(["\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-grow: 1;\n  > span {\n    border: 3px solid var(--border-color);\n    border-radius: 50%;\n    border-top-color: var(--text-color);\n    width: 1em;\n    height: 1em;\n    animation: "," 1s linear 0s infinite;\n  }\n"])),C),L=function(n){var e=n.src,t=void 0===e?"":e,r=n.alt,c=Object(f.useState)(!1),o=Object(O.a)(c,2),a=o[0],i=o[1];return Object(f.useEffect)((function(){i(!1);var n=new Image;n.src=t,n.onload=function(){i(!0),console.log("loaded!")}}),[t]),a?Object(k.jsx)("img",{src:t,alt:r}):Object(k.jsx)(N,{children:Object(k.jsx)("span",{})})},E=w.a.div(a||(a=Object(v.a)(["\n  display: inline-block;\n  padding: 6px 8px;\n  /* margin-top: 8px; */\n  width: calc(50%);\n  vertical-align: top;\n  /* display: inline-block; */\n  /* border-left: 1px solid #fff; */\n  /* border-radius: 4px; */\n  cursor: pointer;\n  box-sizing: border-box;\n  user-select: none;\n  border-bottom: 1px solid var(--border-color);\n  @media screen and (max-width: 450px) {\n    white-space: nowrap;\n    width: 100%;\n    /* overflow: hidden; */\n  }\n"]))),D=w.a.div(i||(i=Object(v.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  /* &:hover {\n    transform: translateY(-2px);\n  } */\n  @media screen and (max-width: 450px) {\n    > a:first-child {\n      max-width: 45vw;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n  > a {\n    color: inherit;\n    font-size: 1.1em;\n    text-decoration: none;\n    font-weight: bold;\n  }\n  img {\n    width: 2rem;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n  span.price {\n    font-weight: bold;\n    font-size: 1.2em;\n    transition: all .1s linear;\n    &.up {\n      color: var(--up-color);\n    }\n    &.down {\n      color: var(--down-color);\n    }\n  }\n  span.percentage {\n    padding: 4px 8px;\n    border-radius: 4px;\n    color: #fff;\n    margin-left: 12px;\n    display: inline-block;\n    text-align: center;\n    /* width: 4.5em; */\n  }\n"]))),I=w.a.div(s||(s=Object(v.a)(["\n  padding-top: 8px;\n  /* border-bottom: 1px solid var(--border-color); */\n  justify-content: space-between;\n  display: flex;\n  button {\n    font-size: 0.8em;\n  }\n  .buttons {\n    display: grid;\n    gap: 4px;\n  }\n"]))),M=w.a.div(l||(l=Object(v.a)(["\n  display: flex;\n  flex-grow: 1;\n  .switch {\n    display: grid;\n    margin-right: 8px;\n    > span {\n      border: 1px solid transparent;\n      border-top-left-radius: 6px;\n      border-bottom-left-radius: 6px;\n      padding: 2px 8px;\n      border-right-color: var(--border-color);\n      &.selected {\n        /* color: yellow; */\n        border-color: var(--border-color);\n        border-right-color: transparent;\n      }\n    }\n  }\n  img {\n    width: 100%;\n  }\n"]))),R=function(n){var e=n.id,t=void 0===e?1:e,r=Object(f.useState)(7),c=Object(O.a)(r,2),o=c[0],a=c[1];return Object(k.jsxs)(M,{children:[Object(k.jsxs)("div",{className:"switch",children:[Object(k.jsx)("span",{className:1===o?"selected":void 0,onClick:function(){return a(1)},children:"24h"}),Object(k.jsx)("span",{className:7===o?"selected":void 0,onClick:function(){return a(7)},children:"7d"}),Object(k.jsx)("span",{className:30===o?"selected":void 0,onClick:function(){return a(30)},children:"30d"}),Object(k.jsx)("span",{className:60===o?"selected":void 0,onClick:function(){return a(60)},children:"60d"}),Object(k.jsx)("span",{className:90===o?"selected":void 0,onClick:function(){return a(90)},children:"90d"})]}),Object(k.jsx)(P,{id:t,period:o})]})},P=function(n){var e=n.id,t=void 0===e?1:e,r=n.period,c=void 0===r?7:r;return Object(k.jsx)(L,{src:"https://s3.coinmarketcap.com/generated/sparklines/web/".concat(c,"d/2781/").concat(t,".svg"),alt:"".concat(t," sparkline")})},_=function(n){var e=n.name,t=n.info,r=n.onRemove,c=n.prices,o=n.setPrices,a=n.idx,i=n.expandStatus,s=n.setExpandStatus,l=t.id,d=t.p24h,u=t.price,p=t.slug,b=t.symbol,j=Object(f.useRef)(u),g=Object(f.useState)(0),m=Object(O.a)(g,2),x=m[0],v=m[1];Object(f.useEffect)((function(){u!==j.current&&void 0!==u&&void 0!==j.current&&(j.current<u?v(1):v(-1),setTimeout((function(){return v(0)}),1e3)),j.current=u}),[u]);var w=function(n){var e=n?-1:1,t=c[a+e];c[a+e]=c[a],c[a]=t;var r=i[a+e];i[a+e]=i[a],i[a]=r,o(Object(h.a)(c)),s(Object(h.a)(i))};Object(f.useEffect)((function(){i[a]=0,s(Object(h.a)(i))}),[]);var y=!!i[a],S=Object(f.useMemo)((function(){return u?u.toFixed(function(n){if(n>=1)return Math.max(1,4-Math.floor(Math.log10(n)));for(var e=-2;1-n>=0;)n*=10,e+=1;return Math.max(4,4+e)}(u)):"-"}),[u]);return Object(k.jsxs)(E,{children:[Object(k.jsxs)(D,{onClick:function(){i[a]=!i[a],s(Object(h.a)(i))},children:[Object(k.jsxs)("a",{href:"https://coinmarketcap.com/currencies/".concat(p,"/"),target:"_blank",rel:"noreferrer",onClick:function(n){return n.stopPropagation()},children:[Object(k.jsx)("img",{src:"https://s2.coinmarketcap.com/static/img/coins/64x64/".concat(l,".png"),alt:l}),e||b||"unknown"]}),Object(k.jsxs)("span",{children:[Object(k.jsx)("span",{className:"price ".concat(1===x?"up":-1===x?"down":void 0),children:S}),Object(k.jsx)("span",{className:"percentage",style:{backgroundColor:d>0?"rgba(0, 255, 0, ".concat(Math.sqrt(Math.abs(d/10)),")"):"rgba(255, 0, 0, ".concat(Math.sqrt(Math.abs(d/10)),")")},children:d?"".concat(d.toFixed(2),"%"):""})]})]},l),y&&Object(k.jsxs)(I,{children:[Object(k.jsx)(R,{id:l}),Object(k.jsxs)("div",{className:"buttons",children:[Object(k.jsx)("button",{onClick:function(){return w(!0)},disabled:0===a,children:"\u2b06"}),Object(k.jsx)("button",{onClick:function(){return w()},disabled:a===c.length-1,children:"\u2b07"}),Object(k.jsx)("button",{onClick:function(){return r(l)},className:"danger",children:"\u2573"})]})]})]})},A=w.a.div(d||(d=Object(v.a)(["\n  cursor: pointer;\n  margin: 4px auto;\n  > img {\n    width: 1.5em;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n"]))),F=w.a.div(u||(u=Object(v.a)(["\n  margin: 12px 0px;\n  > div {\n    position: absolute;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    width: 100%;\n    text-align: left;\n    padding-left: 8px;\n  }\n"]))),J=function(n){var e=n.onAdd,t=n.mapData,r=Object(f.useState)(""),c=Object(O.a)(r,2),o=c[0],a=c[1],i=Object.values(t),s=Object(f.useRef)(null),l=o?i.filter((function(n){return n.name.toLowerCase().includes(o.toLowerCase())||n.symbol.toLowerCase().includes(o.toLowerCase())})):[];return Object(k.jsxs)(F,{children:[Object(k.jsx)("input",{value:o,onChange:function(n){return a(n.target.value)},placeholder:i.length?"Type Something...":"Loading...",disabled:!i.length,ref:s}),l.length?Object(k.jsx)("div",{children:l.slice(0,10).map((function(n){return Object(k.jsxs)(A,{onClick:function(){e(n.id),a(""),setTimeout((function(){var n;null===(n=s.current)||void 0===n||n.focus()}),500)},children:[Object(k.jsx)("img",{src:"https://s2.coinmarketcap.com/static/img/coins/64x64/".concat(n.id,".png"),alt:n.id}),n.name]},n.id)}))}):null]})},T=t(13),z=t.n(T),q=function(n,e){var t=Object(f.useState)(new Date),r=Object(O.a)(t,2),c=r[0],o=r[1],a=function(){return z.a.get("https://api.coinmarketcap.com/data-api/v3/cryptocurrency/listing?ids=".concat(n.join(","),"&aux=ath")).then((function(n){var t=n.data;if(null===t||void 0===t?void 0:t.data){var r=t.data.cryptoCurrencyList;o(new Date),e((function(n){return n.map((function(n){var e,t,c,o,a=r.find((function(e){return e.id===n.id}));return a?Object(x.a)(Object(x.a)({},n),{},{price:(null===(e=a.quotes)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.price)||0,p24h:(null===(c=a.quotes)||void 0===c||null===(o=c[0])||void 0===o?void 0:o.percentChange24h)||0,name:a.name,slug:a.slug}):n}))}))}}))};return Object(f.useEffect)((function(){a()}),[n.length,e]),[a,c]},Y=function(n){var e=Object(f.useState)((function(){return localStorage.getItem(n)?JSON.parse(String(localStorage.getItem(n))).data:{}})),t=Object(O.a)(e,2),r=t[0],c=t[1],o=Object(f.useCallback)((function(){return z.a.get("https://api.coinmarketcap.com/data-api/v3/map/all?cryptoAux=status&limit=10000&listing_status=active&start=1").then((function(e){var t=e.data.data.cryptoCurrencyMap.reduce((function(n,e){return n[e.id]=e,n}),{});c(t),localStorage.setItem(n,JSON.stringify({data:t,timeStamp:+new Date}))}))}),[n]);return Object(f.useEffect)((function(){localStorage.getItem(n)?JSON.parse(String(localStorage.getItem(n))).timeStamp+864e5<=+new Date&&(console.log("refetch!"),o()):(console.log("init fetch!"),o())}),[o,n]),r},U=function(n,e){var t=Object(f.useRef)(!1);Object(f.useEffect)((function(){t.current?(console.log("exec!"),n()):t.current=!0}),[e])},B="LOCAL_ID_KEY",K=w.a.div(p||(p=Object(v.a)(["\n  text-align: left;\n  padding: 0px 8px;\n  /* padding-top: 8px; */\n"]))),W=w.a.div(b||(b=Object(v.a)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  > div:first-child {\n    flex-grow: 1;\n  }\n"])));function G(){var n=Object(f.useState)(0),e=Object(O.a)(n,2),t=e[0],r=e[1],c=Object(f.useState)((function(){var n=new URL(window.location.href).searchParams.get("ids");return n?n.split("_").map((function(n){return{id:Number(n)||1}})):[]})),o=Object(O.a)(c,2),a=o[0],i=o[1],s=Object(f.useState)((function(){return Array.from({length:a.length}).fill(0)})),l=Object(O.a)(s,2),d=l[0],u=l[1],p=a.map((function(n){return n.id})),b=Object(f.useRef)(!1),j=Y("LOCAL_KEY"),g=Object(f.useRef)(),m=q(p,i),v=Object(O.a)(m,2),w=v[0],y=v[1],C=function n(){var e;try{e=new WebSocket("wss://stream.coinmarketcap.com/price/latest"),g.current=e}catch(t){setTimeout((function(){n(),N(p)}),1e3)}},N=function n(e){if(g.current){var t=g.current;r(t.readyState),t.onopen=function(){console.log("ws connected!"),r(t.readyState),b.current&&(b.current=!1);var c={method:"subscribe",id:"price",data:{cryptoIds:e}};t.send(JSON.stringify(c)),t.onmessage=function(n){var e,t=JSON.parse(n.data);if(null===t||void 0===t||null===(e=t.d)||void 0===e?void 0:e.cr){var r=t.d.cr;i((function(n){return n.map((function(n){return n.id===r.id?Object(x.a)(Object(x.a)(Object(x.a)({},r),n),{},{price:r.p,p24h:r.p24h}):n}))}))}else console.log(t)},t.addEventListener("close",(function(c){console.log("ws closed!"),r(t.readyState),b.current||(console.log("reconnecting..."),w(),setTimeout((function(){C(),n(e)}),1e3))}))}}},L=function(){console.log("reconnect!"),function(){var n;null===(n=g.current)||void 0===n||n.close()}(),C(),N(p)},E=function(n,e){p.includes(n)&&e||i((function(t){return e?[].concat(Object(h.a)(t),[{id:n}]):t.filter((function(e){return e.id!==n}))}))},D=function(n){u(n?function(n){return n.map((function(n){return 1}))}:function(n){return n.map((function(n){return 0}))})},I=function(n){var e=new URL(window.location.href);e.searchParams.set("ids",n),window.history.replaceState("",document.title,e)};return Object(f.useEffect)((function(){var n=localStorage.getItem(B);n!==new URL(window.location.href).searchParams.get("ids")&&n&&I(n)}),[]),U((function(){var n=p.join("_");I(n),localStorage.setItem(B,n)}),p.join()),Object(f.useEffect)((function(){p.length&&(b.current=!0,L())}),[p.length]),Object(k.jsxs)("div",{className:"App",children:[Object(k.jsxs)(W,{children:[Object(k.jsx)(J,{onAdd:function(n){return E(n,!0)},mapData:j}),Object(k.jsx)("button",{onClick:function(){return D(!1)},children:"Collapse"}),"\xa0",Object(k.jsx)("button",{onClick:function(){return D(!0)},children:"Expand"})]}),Object(k.jsx)(K,{children:a.map((function(n,e){var t;return Object(k.jsx)(_,{name:null===(t=j[n.id])||void 0===t?void 0:t.symbol,info:n,onRemove:function(n){return E(n)},prices:a,setPrices:i,idx:e,expandStatus:d,setExpandStatus:u},n.id)}))}),p.length?Object(k.jsx)(S,{wsStatus:t,lastRefetch:y}):null]})}var H=function(n){n&&n instanceof Function&&t.e(3).then(t.bind(null,55)).then((function(e){var t=e.getCLS,r=e.getFID,c=e.getFCP,o=e.getLCP,a=e.getTTFB;t(n),r(n),c(n),o(n),a(n)}))};m.a.render(Object(k.jsx)(j.a.StrictMode,{children:Object(k.jsx)(G,{})}),document.getElementById("root")),H()}},[[54,1,2]]]);
//# sourceMappingURL=main.db06dfb4.chunk.js.map