{"version":3,"sources":["Footer.tsx","Cell.tsx","Add.tsx","hooks/useGetListings.ts","hooks/useGetMapStorage.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Wrapper","styled","p","Footer","wsInstance","lastRefetch","status","current","readyState","statusString","undefined","className","href","target","rel","Date","Number","toFixed","CellWrapper","div","Operations","PriceCell","info","onRemove","prices","setPrices","idx","id","p24h","price","name","slug","lastPrice","useRef","isUp","useState","expand","setExpand","useEffect","onMove","idxOffset","temp","onClick","e","stopPropagation","src","alt","style","backgroundColor","Math","sqrt","abs","disabled","length","TokenList","AddToken","onAdd","mapData","search","setSearch","mapArr","Object","values","ref","searchRes","filter","token","toLowerCase","includes","symbol","margin","value","onChange","placeholder","slice","map","r","setTimeout","focus","useGetListings","ids","setter","setLastRefetch","refetch","axios","get","join","then","priceData","data","cryptoCurrencyList","d","find","quotes","percentChange24h","useGetMapStorage","key","localStorage","getItem","JSON","parse","String","setMapData","fetchMap","useCallback","storedData","cryptoCurrencyMap","reduce","prev","next","setItem","stringify","timeStamp","console","log","App","setWSStatus","URL","window","location","searchParams","split","resubscribing","WSInstance","refetchAPI","initWS","WS","WebSocket","subscribeWS","onopen","param","method","cryptoIds","send","onmessage","res","cr","addEventListener","reconnect","close","closeWS","handleAddOrRemove","add","url","set","history","replaceState","document","title","Add","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.ebd1ddd1.chunk.js","sourcesContent":["import styled from \"styled-components\";\n\n// const;\n\nconst Wrapper = styled.p`\n  position: fixed;\n  bottom: 0;\n  margin: 0px auto;\n  font-size: 0.8em;\n  padding: 8px;\n  width: 100%;\n  background-color: var(--background-color);\n  /* border-top: 1px solid var(--border-color); */\n  display: grid;\n  grid-auto-flow: column;\n  grid-template-columns: 1fr 1fr 1fr;\n  align-items: center;\n  transition: all 0.3s ease-in-out, transform 0.3s linear 3s;\n\n  backdrop-filter: blur(6px);\n  a {\n    color: var(--text-color);\n    color: inherit;\n  }\n\n  &.Connecting {\n    background-color: yellow;\n    color: #000;\n  }\n  &.Connected {\n    background-color: rgba(0, 255, 0, 0.33);\n    transform: translateY(calc(100% - 1px));\n  }\n  &.Disconnected {\n    background-color: var(--down-color);\n  }\n  > *:first-child {\n    justify-self: start;\n  }\n  > *:last-child {\n    justify-self: end;\n  }\n`;\n\nconst Footer = ({\n  wsInstance,\n  lastRefetch,\n}: // reconnect,\n{\n  wsInstance: React.MutableRefObject<WebSocket | undefined>;\n  lastRefetch: Date;\n  // reconnect: any;\n}) => {\n  const status = wsInstance.current?.readyState;\n  //   console.log(status);\n  const statusString =\n    status === 0 || status === undefined\n      ? \"Connecting\"\n      : status === 1\n      ? \"Connected\"\n      : status === 3\n      ? \"Disconnected\"\n      : undefined;\n  return (\n    <Wrapper className={statusString}>\n      <span>\n        Data Provider:{\" \"}\n        <a href=\"https://coinmarketcap.com/\" target=\"_blank\" rel=\"noreferrer\">\n          CoinMarketCap\n        </a>\n      </span>\n      <span>\n        <i>\n          {((+new Date() - Number(lastRefetch)) / 1000).toFixed(0) +\n            \" Seconds ago\"}\n        </i>\n      </span>\n      <span>\n        <i>{statusString}</i>\n      </span>\n    </Wrapper>\n  );\n};\n\nexport default Footer;\n","import { useEffect, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\n\nconst CellWrapper = styled.div`\n  display: inline-flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 6px 8px;\n  /* margin-top: 8px; */\n  width: calc(50% - 17px);\n  /* display: inline-block; */\n  /* border-left: 1px solid #fff; */\n  /* border-radius: 4px; */\n  cursor: pointer;\n  box-sizing: border-box;\n  user-select: none;\n  border-bottom: 1px solid var(--border-color);\n  /* &:hover {\n    transform: translateY(-2px);\n  } */\n  @media screen and (max-width: 450px) {\n    white-space: nowrap;\n    width: 100%;\n    border-left: none;\n    /* overflow: hidden; */\n    > a:first-child {\n      max-width: 45vw;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n  > a {\n    color: inherit;\n    font-size: 0.9em;\n    text-decoration: none;\n  }\n  img {\n    width: 2.1em;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n  span.price {\n    font-weight: bold;\n    font-size: 1.1em;\n    &.up {\n      color: var(--up-color);\n    }\n    &.down {\n      color: var(--down-color);\n    }\n  }\n  span.percentage {\n    padding: 4px;\n    border-radius: 4px;\n    color: #fff;\n    margin-left: 12px;\n    display: inline-block;\n    text-align: center;\n    width: 4.5em;\n  }\n`;\n\nconst Operations = styled.div`\n  padding: 8px;\n  border-bottom: 1px solid var(--border-color);\n  justify-content: space-between;\n  display: flex;\n  button {\n    font-size: 0.8em;\n  }\n`;\n\nconst PriceCell = ({ info, onRemove, prices, setPrices, idx }: any) => {\n  const { id, p24h, price, name, slug } = info;\n  const lastPrice = useRef(price);\n  const isUp = useRef(true);\n\n  const [expand, setExpand] = useState(false);\n\n  useEffect(() => {\n    if (price !== lastPrice.current) {\n      //   console.log(\"update!\", price);\n      isUp.current = lastPrice.current < price || price === undefined;\n      lastPrice.current = price;\n    }\n    // console.log(\"price change!\", lastPrice.current, price);\n  }, [price]);\n  //   console.log(price)\n  //   const isUp = lastPrice.current < price || price === undefined;\n  //   const isEqual = lastPrice.current === price;\n  //   console.log(isEqual);\n  //   console.log(expand);\n\n  const onMove = (isUp?: boolean) => {\n    // let temp;\n    const idxOffset = isUp ? -1 : 1;\n    // if (isUp) {\n    const temp = prices[idx + idxOffset];\n    prices[idx + idxOffset] = prices[idx];\n    prices[idx] = temp;\n    setPrices([...prices]);\n    // } else {\n    //     temp = prices[idx - 1];\n    //     prices[idx - 1] = prices[idx];\n    //     prices[idx] = temp;\n    //     setPrices([...prices]);\n    // }\n  };\n\n  return (\n    <>\n      <CellWrapper\n        key={id}\n        onClick={() => {\n          // console.log(\"click!\", expand);\n          setExpand(!expand);\n        }}\n      >\n        <a\n          href={`https://coinmarketcap.com/currencies/${slug}/`}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          <img\n            src={`https://s2.coinmarketcap.com/static/img/coins/64x64/${id}.png`}\n            alt={id}\n          />\n          {name || \"unknown\"}\n        </a>\n        <span>\n          <span className={`price ${isUp.current ? \"up\" : \"down\"}`}>\n            {price ? price?.toFixed(4) : \"-\"}\n            {isUp.current ? \"↑\" : \"↓\"}\n          </span>\n          <span\n            className=\"percentage\"\n            style={{\n              backgroundColor:\n                p24h > 0\n                  ? `rgba(0, 255, 0, ${Math.sqrt(Math.abs(p24h / 10))})`\n                  : `rgba(255, 0, 0, ${Math.sqrt(Math.abs(p24h / 10))})`,\n            }}\n          >\n            {p24h ? `${p24h.toFixed(2)}%` : \"\"}\n          </span>\n        </span>\n      </CellWrapper>\n      {expand && (\n        <Operations>\n          <button onClick={() => onMove(true)} disabled={idx === 0}>\n            Move Up↑\n          </button>\n          <button onClick={() => onMove()} disabled={idx === prices.length - 1}>\n            Move Down↓\n          </button>\n          <button onClick={() => onRemove(id)} className=\"danger\">\n            Delete\n          </button>\n        </Operations>\n      )}\n    </>\n  );\n};\n\nexport default PriceCell;\n","import { useEffect, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\n\nconst TokenList = styled.div`\n  cursor: pointer;\n  margin: 4px auto;\n  > img {\n    width: 1.5em;\n    margin-right: 0.5em;\n    vertical-align: middle;\n  }\n`;\n\nconst AddToken = ({ onAdd, mapData }: any) => {\n  const [search, setSearch] = useState(\"\");\n  const mapArr = Object.values(mapData);\n  const ref = useRef<HTMLInputElement>(null);\n\n  // useEffect(() => {\n  //   ref.current?.focus();\n  // }, []);\n\n  const searchRes = search\n    ? mapArr.filter(\n        (token: any) =>\n          token.name.toLowerCase().includes(search.toLowerCase()) ||\n          token.symbol.toLowerCase().includes(search.toLowerCase())\n      )\n    : [];\n  return (\n    <div\n      style={{\n        margin: \"12px 0px\",\n      }}\n    >\n      <input\n        value={search}\n        onChange={(e) => setSearch(e.target.value)}\n        placeholder={mapArr.length ? \"Type Something...\" : \"Loading...\"}\n        disabled={!mapArr.length}\n        ref={ref}\n      />\n      <div>\n        {searchRes.slice(0, 10).map((r: any) => (\n          <TokenList\n            key={r.id}\n            onClick={() => {\n              onAdd(r.id);\n              setSearch(\"\");\n              setTimeout(() => {\n                ref.current?.focus();\n              }, 500);\n            }}\n          >\n            <img\n              src={`https://s2.coinmarketcap.com/static/img/coins/64x64/${r.id}.png`}\n              alt={r.id}\n            />\n            {r.name}\n          </TokenList>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default AddToken;\n","import axios from \"axios\";\nimport { useEffect, useState } from \"react\";\n\nconst useGetListings = (\n  ids: number[],\n  setter: React.Dispatch<\n    React.SetStateAction<\n      {\n        id: number;\n        price?: number | undefined;\n        p24h?: number | undefined;\n      }[]\n    >\n  >\n  // refetch: boolean\n): [() => Promise<any>, Date] => {\n  // console.log(refetch);\n\n  const [lastRefetch, setLastRefetch] = useState(new Date());\n\n  const refetch = () =>\n    axios\n      .get(\n        `https://api.coinmarketcap.com/data-api/v3/cryptocurrency/listing?ids=${ids.join(\n          \",\"\n        )}&aux=ath`\n      )\n      .then(({ data }) => {\n        const priceData = data.data.cryptoCurrencyList;\n        setLastRefetch(new Date());\n        setter((data) => {\n          return data.map((d) => {\n            const find = priceData.find((p: any) => p.id === d.id);\n            // console.log(find);\n            // console.log(d.id);\n            if (find) {\n              return {\n                ...d,\n                price: find.quotes?.[0]?.price || 0,\n                p24h: find.quotes?.[0]?.percentChange24h || 0,\n                name: find.name,\n                slug: find.slug,\n              };\n            } else {\n              return d;\n            }\n          });\n        });\n      });\n  useEffect(() => {\n    refetch();\n    // if (!refetch) return;\n    // console.log(\"call!!\");\n  }, [ids.length, setter]);\n  return [refetch, lastRefetch];\n};\n\nexport default useGetListings;\n","import axios from \"axios\";\nimport { useCallback, useEffect, useState } from \"react\";\n\nconst useGetMapStorage = (key: string) => {\n  const [mapData, setMapData] = useState<any>(() =>\n    localStorage.getItem(key)\n      ? JSON.parse(String(localStorage.getItem(key))).data\n      : {}\n  );\n  const fetchMap = useCallback(\n    () =>\n      axios\n        .get(\n          \"https://api.coinmarketcap.com/data-api/v3/map/all?cryptoAux=status&limit=10000&listing_status=active&start=1\"\n        )\n        .then(({ data }) => {\n          const storedData = data.data.cryptoCurrencyMap.reduce(\n            (prev: any, next: any) => {\n              prev[next.id] = next;\n              return prev;\n            },\n            {}\n          );\n          // console.log(storedData);\n          setMapData(storedData);\n          localStorage.setItem(\n            key,\n            JSON.stringify({\n              data: storedData,\n              timeStamp: +new Date(),\n            })\n          );\n        }),\n    [key]\n  );\n  useEffect(() => {\n    if (localStorage.getItem(key)) {\n      const timeStamp = JSON.parse(String(localStorage.getItem(key))).timeStamp;\n      if (timeStamp + 1000 * 3600 * 24 <= +new Date()) {\n        console.log(\"refetch!\");\n        fetchMap();\n      }\n    } else {\n      console.log(\"init fetch!\");\n      fetchMap();\n    }\n  }, [fetchMap, key]);\n  return mapData;\n};\n\nexport default useGetMapStorage;\n","import { useEffect, useRef, useState } from \"react\";\n\nimport styled from \"styled-components\";\nimport Footer from \"./Footer\";\nimport PriceCell from \"./Cell\";\n// import useGetMapStorage from \"./hooks/useGetMapStorage\";\nimport WSStatus from \"./Status\";\nimport AddToken from \"./Add\";\nimport useGetListings from \"./hooks/useGetListings\";\nimport useGetMapStorage from \"./hooks/useGetMapStorage\";\n\nconst Separater = \"_\";\n\nconst LOCAL_KEY = \"LOCAL_KEY\";\n\nconst Wrapper = styled.div`\n  text-align: left;\n  padding: 0px 8px;\n  /* padding-top: 8px; */\n`;\n\nexport default function App() {\n  const [wsStatus, setWSStatus] = useState<number>(0);\n  const [prices, setPrices] = useState<\n    {\n      id: number;\n      price?: number;\n      p24h?: number;\n      slug?: string;\n      name?: string;\n    }[]\n  >(() => {\n    const ids = new URL(window.location.href).searchParams.get(\"ids\");\n    if (ids) {\n      return ids.split(Separater).map((id) => ({\n        id: Number(id),\n      }));\n    }\n    return [];\n  });\n\n  const ids = prices.map(({ id }) => id);\n\n  const resubscribing = useRef(false);\n\n  const mapData = useGetMapStorage(LOCAL_KEY);\n\n  const WSInstance = useRef<WebSocket>();\n\n  const [refetchAPI, lastRefetch] = useGetListings(ids, setPrices);\n\n  const initWS = () => {\n    let WS;\n    try {\n      WS = new WebSocket(\"wss://stream.coinmarketcap.com/price/latest\");\n      WSInstance.current = WS;\n    } catch (e) {\n      setTimeout(() => {\n        initWS();\n        subscribeWS(ids);\n      }, 1000);\n    }\n  };\n\n  const closeWS = () => {\n    WSInstance.current?.close();\n  };\n\n  const subscribeWS = (ids: number[]) => {\n    if (!WSInstance.current) return;\n    const WS = WSInstance.current;\n    setWSStatus(WS.readyState);\n    WS.onopen = function () {\n      console.log(\"ws connected!\");\n      setWSStatus(WS.readyState);\n      if (resubscribing.current) {\n        resubscribing.current = false;\n      }\n      const param = {\n        method: \"subscribe\",\n        id: \"price\",\n        data: {\n          cryptoIds: ids,\n        },\n      };\n      WS.send(JSON.stringify(param));\n\n      WS.onmessage = function (res) {\n        const data = JSON.parse(res.data);\n        if (data?.d?.cr) {\n          const info = data.d.cr;\n          setPrices((prices) => {\n            return prices.map((p) => {\n              if (p.id === info.id) {\n                return {\n                  ...p,\n                  price: info.p,\n                  p24h: info.p24h,\n                };\n              }\n              return p;\n            });\n          });\n        } else {\n          console.log(data);\n        }\n      };\n      WS.addEventListener(\"close\", (e) => {\n        console.log(\"ws closed!\");\n        setWSStatus(WS.readyState);\n        if (!resubscribing.current) {\n          console.log(\"reconnecting...\");\n          refetchAPI();\n          setTimeout(() => {\n            initWS();\n            subscribeWS(ids);\n          }, 1000);\n        }\n      });\n    };\n  };\n\n  const reconnect = () => {\n    console.log(\"reconnect!\");\n    closeWS();\n    initWS();\n    subscribeWS(ids);\n  };\n\n  const handleAddOrRemove = (id: number, add?: boolean) => {\n    if (ids.includes(id) && add) {\n      return;\n    }\n    setPrices((prices) => {\n      const newPrices = add\n        ? [\n            ...prices,\n            {\n              id: id,\n            },\n          ]\n        : prices.filter((price) => price.id !== id);\n      return newPrices;\n    });\n  };\n\n  /**\n   * rewrite URL when id length / order changes\n   */\n  useEffect(() => {\n    const url = new URL(window.location.href);\n    url.searchParams.set(\"ids\", ids.join(Separater));\n    window.history.replaceState(\"\", document.title, url);\n  }, [ids.join()]);\n\n  /**\n   * resubscribe when id length changes\n   */\n  useEffect(() => {\n    if (ids.length) {\n      resubscribing.current = true;\n      reconnect();\n    }\n  }, [ids.length]);\n\n  return (\n    <div className=\"App\">\n      {/* <Gas /> */}\n      <AddToken\n        onAdd={(id: number) => handleAddOrRemove(id, true)}\n        mapData={mapData}\n      />\n      <Wrapper>\n        {prices.map((info: any, idx) => (\n          <PriceCell\n            key={info.id}\n            info={info}\n            onRemove={(id: number) => handleAddOrRemove(id)}\n            prices={prices}\n            setPrices={setPrices}\n            idx={idx}\n          />\n        ))}\n      </Wrapper>\n      {/* <WSStatus /> */}\n      {ids.length ? (\n        <Footer\n          wsInstance={WSInstance}\n          // reconnect={reconnect}\n          lastRefetch={lastRefetch}\n        />\n      ) : null}\n      \n      {/* <div>\n        <button onClick={() => closeWS()}>Disconnect</button>\n        <button\n          onClick={() => {\n            initWS();\n            subscribeWS(ids);\n          }}\n        >\n          Connect\n        </button>\n      </div> */}\n    </div>\n  );\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}